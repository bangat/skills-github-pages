// [보안 수정] 로그인 로직을 서버 측에서 처리하도록 변경
async function tryLogin() {
    // 🚨 중요: 이 URL을 실제 배포된 checkAdminPassword 함수 URL로 교체해야 합니다!
    const checkPasswordUrl = 'https://us-central1-hallymlinen.cloudfunctions.net/checkAdminPassword';

    // 로딩 표시
    const okButton = el("#adminOk");
    const originalText = okButton.textContent;
    okButton.disabled = true;
    okButton.textContent = '확인 중...';

    try {
        const response = await fetch(checkPasswordUrl, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                pin: pin
            }) // 입력된 PIN을 서버로 전송
        });

        const result = await response.json();

        // [수정된 부분] ⬅️ 바로 이 부분입니다!
        if (response.ok && result.success && result.token) {
            // 1. 받은 토큰을 브라우저의 localStorage에 저장합니다.
            localStorage.setItem('adminToken', result.token);

            // 2. 모달을 닫고 출근부 페이지로 이동합니다.
            closeModal("#adminModal");
            location.href = "출근부.html";
        } else {
            clearPin();
            $in.placeholder = "인증오류.";
            try {
                playSnd("#warnSound");
            } catch (_) {}
            $ok.focus();
        }
    } catch (error) {
        // 네트워크 오류 또는 서버 함수 문제 처리
        console.error('비밀번호 확인 중 오류:', error);
        clearPin();
        $in.placeholder = "인증 오류";
        try {
            playSnd("#warnSound");
        } catch (_) {}
        $ok.focus();
    } finally {
        // 버튼 상태 복원
        okButton.disabled = false;
        okButton.textContent = originalText;
    }
}
